version: "1.0"
config:
  stop_on_failure: true

steps:
  - name: generate_training_data
    type: datafusion.sql
    params:
      sql: |
        SELECT
          1.0 as feature1,
          2.0 as feature2,
          10.0 as target
        UNION ALL
        SELECT
          2.0 as feature1,
          3.0 as feature2,
          20.0 as target
        UNION ALL
        SELECT
          3.0 as feature1,
          4.0 as feature2,
          30.0 as target
    output: training_data

  - name: train_model
    type: tetnus.train
    input: training_data
    params:
      output_model: "model.bin"
      model:
        type: "TabularTransformer"
        target_column: "target"

  - name: generate_inference_data
    type: datafusion.sql
    depends_on: [train_model]
    params:
      sql: |
        SELECT
          4.0 as feature1,
          5.0 as feature2
    output: inference_data

  - name: predict
    type: tetnus.predict
    input: inference_data
    output: predictions
    params:
      model: "model.bin"
      prediction_column: "predicted_target"

  - name: save_predictions
    type: parquet.write
    input: predictions
    params:
      path: "predictions.parquet"
